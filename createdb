#!/usr/bin/perl

use DBI;
use strict;

use Getopt::GUI::Long;
Getopt::GUI::Long::Configure(qw(display_help no_ignore_case capture_output));

my %opts = ('d' => 'FCC-data',
	    'D' => 'hammap');
my $sth;

GetOptions(\%opts,
	   ["c|create-dbs", "Drop and recreate the tables"],
	   ["u|initial-user=s", "Initial user"],
	   ["g|initial-group=s", "Initial group"],
	   ["p|initial-group-password=s", "Initial Group Password"],
	   ["P|initial-group-admin-password=s", "Initial Group Admin Password"],
	   ["D|db=s","DB File (defaults to 'hammap')"],
	   ["nogui", "Don't launch using a gui"],
	  ) || die;

if (!exists($opts{'u'}) ||
    !exists($opts{'g'}) ||
    !exists($opts{'p'}) ||
    !exists($opts{'P'})) {
    print STDERR "-u, -g, -p and -P are all required\n";
    exit 1;
}


if ($opts{'c'}) {
    unlink($opts{D});
}

my $dbh = DBI->connect("DBI:SQLite:dbname=$opts{D}");

    $dbh->do("create table people
(
      id                        int,
      callsign                  char(10)
)");

    $dbh->do("insert into people values(1, '$opts{'u'}')");

    $dbh->do("create table groups
(
      id                        int,
      name                      char(64),
      password                  char(64),
      adminpass                 char(64)
)");

    $dbh->do("insert into groups values(1,'$opts{'g'}','$opts{'p'}','$opts{'P'}')");

    $dbh->do("create table members
(
      groupid                   int,
      groupperson               int
)");

    $dbh->do("insert into members values(1,1)");

    $dbh->do("create table events
(
      eventid                   int,
      eventgroup                int,
      eventname                 varchar(64),
      eventband                 varchar(64),
      eventdate                 varchar(64),
      eventstart                varchar(64),
      eventdescription          varchar(4096)
)");

$dbh->do("insert into events values(1,1,'Test Net','2M','2008/03/02','7:30PM', '')");

    $dbh->do("create table locations
(
      locationid          int,
      locationperson      int,
      locationname        varchar(64),
      locationtype        varchar(64),
      locationlat         varchar(4096),
      locationlon         varchar(4096),
      locationaddress     varchar(4096),
      locationcity        varchar(4096),
      locationstate       varchar(4096),
      locationzip         int
)");

    $dbh->do("insert into locations (locationid, locationperson, locationname,
                                     locationtype, locationaddress,
                                     locationcity, locationstate, locationzip)
                          values(1,1,'Home','Address','4240 Arroyo Ave',
                                 'Davis', 'CA',95616)");

    $dbh->do("create table eventmembers
(
      eventid                   int,
      eventperson               int,
      eventpersonlocation       int,
      eventpersondetails        varchar(4096)
)");

    $dbh->do("create table connections
(
      eventid                   int,
      listener                  int,
      heard                     int,
      comment                   char(10),
      rating                    int
)");
